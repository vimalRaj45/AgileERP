<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Leaderboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-4">

  <!-- üîô Back Button -->
  <button class="btn btn-secondary mb-3" onclick="window.history.back()">‚Üê Back</button>

  <h2 class="mb-3">User Leaderboard</h2>

  <div class="mb-3">
    <label class="form-label">Sort By</label>
    <select id="sort" class="form-select w-25" onchange="load()">
      <option value="score">Score</option>
      <option value="completed_tasks">Completed Tasks</option>
      <option value="files_uploaded">Files</option>
      <option value="comments_count">Comments</option>
    </select>
  </div>

  <div class="table-responsive">
    <table class="table table-bordered table-striped">
      <thead class="table-dark">
        <tr>
          <th>Rank</th>
          <th>User</th>
          <th>Score</th>
          <th>Tasks</th>
          <th>Files</th>
          <th>Comments</th>
          <th>Actions</th>
          <th>Activity</th>
        </tr>
      </thead>
      <tbody id="body"></tbody>
    </table>
  </div>

  <div class="alert alert-info mt-3">
    <strong>How your score is given:</strong><br>
    Your score is calculated based on the work you complete in the system.
    Completing tasks gives the highest points, while uploading files, adding comments,
    and being active also add points. All points together form your total score.
  </div>

</div>

<script>
async function load() {
  const res = await fetch("/api/leaderboard/advanced");
  let data = await res.json();

  const sortBy = document.getElementById("sort").value;
  data.sort((a,b) => b[sortBy] - a[sortBy]);

  const tbody = document.getElementById("body");
  tbody.innerHTML = "";

  data.forEach((u,i) => {
    tbody.innerHTML += `
      <tr>
        <td>${i+1}</td>
        <td>${u.username}</td>
        <td>${u.score}</td>
        <td>${u.completed_tasks}/${u.total_tasks}</td>
        <td>${u.files_uploaded}</td>
        <td>${u.comments_count}</td>
        <td>${u.action_items_done}</td>
        <td>${u.activities}</td>
      </tr>
    `;
  });
}
load();
</script>

</body>
</html>
